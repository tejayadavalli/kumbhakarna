<!DOCTYPE html>
<html>
<head>
    <meta charset=”utf-8”>
    <title>Room Status</title>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>


    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/js/bootstrap-multiselect.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/css/bootstrap-multiselect.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.7.14/js/bootstrap-datetimepicker.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.7.14/css/bootstrap-datetimepicker.min.css">


    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <style type="text/css">
         .btn {
         padding: 30px 5px;
         font-size: 24px;
         }
         .row{
         font-size: 14px;
         text-align: center;
         }
         .toggle-group .btn{
            padding: 5px 14px;
            font-size: 14px;
         }

         .toggle{
            padding: 7% 14px;
            font-size: 14px;
         }

         .modal-footer .btn{
            padding: 7% 14px;
            font-size: 14px;
         }
         .modal-footer .btn{
            padding: 5px 14px;
            font-size: 14px;
         }

      </style>
</head>
<body>
<script type="text/javascript">
           var submitedData = {};
           var roomsData = {};
           function refreshData(){
               $.ajax({
               url: './get-status',
               type: 'get',
               dataType: "json",
               contentType:"application/json; charset=utf-8",
               success: function(data){
                 roomsData = data;
                 updateData();
               },
               error: function (xhr, ajaxOptions, thrownError) {
                 $("#successIndicator").text(thrownError);
               }
               });
           }

           $( document ).ready(function(){
                $('#datepicker1').datetimepicker({
                    format: 'DD/MM/YYYY LT'
                });
                refreshData();
           });

           function updateData(){
              for(var key in roomsData["roomsData"]){
                switch(roomsData["roomsData"][key]["roomStatus"]) {
                     case "AVAILABLE":
                        $("#" + key).removeClass("btn-primary").removeClass("btn-danger")
                        .addClass("btn-success");
                        break;
                     case "OCCUPIED":
                        $("#" + key).removeClass("btn-primary").removeClass("btn-success")
                        .addClass("btn-danger");
                        break;
                     case "CHECKOUT":
                        $("#" + key).removeClass("btn-danger").removeClass("btn-success")
                        .addClass("btn-primary");
                        break;
                     default:
                        break;
              }
           }
           }

           function submitData(room, action){
              var postData = {};
              postData['room'] = room.trim();
              postData['roomStatus'] = action.toUpperCase();;
              postData['name'] = $("#name").val().trim();
              postData['phone'] = $("#phone").val().trim();
              postData['extraBed'] = $("#extraBed").prop('checked');
              postData['plan'] = ($("#plan").prop('checked')) ? 'CP' : 'EP';
              postData['remark'] = $("#remark").val();
              postData['tariff'] = parseInt($("#tariff").val());
              postData['checkInTime'] = $("#datepicker1").val();
              postData['guestCount'] = parseInt($("#guest_count").val());
              if(postData['name'].length == 0){
                alert("Provide Valid Name");
                return;
              }

              if(postData['phone'].length != 10){
                alert("Provide Valid Phone Number");
                return;
              }

              if(isNaN(postData['guestCount'])){
                alert("Provide Valid Guests");
                return;
              }

              if(isNaN(postData['tariff']) || postData['tariff'] < 100){
                alert("Provide Valid Tariff");
                return;
              }

             if(postData['checkInTime'].length == 0){
                alert("Provide Valid Check In");
                return;
              }


              $.ajax({
               url: './update-status',
               type: 'post',
               dataType: "json",
               contentType:"application/json; charset=utf-8",
               success: function(data){
                   refreshData();
                   $('#cancel-btn').click();
                   $(".modal-backdrop").removeClass("modal-backdrop");
               },
               error: function (xhr, ajaxOptions, thrownError) {
                 $("#successIndicator").text(thrownError);
               },
               data: JSON.stringify(postData)
           });

           }
           function updateModal(room){
                room = room.trim();
                data = roomsData["roomsData"][room];
                $("#roomNumber").html(room);
                $("#name").val(data["name"]);
                $("#phone").val(data["phone"]);
                $("#guest_count").val(data["guestCount"]);
                $("#remark").val(data["remark"]);
                $("#datepicker1").val(data["checkInTime"]);
                $("#tariff").val(parseInt(data["tariff"]));
                switch(data["plan"]){
                   case "CP":
                    $("#plan-div .toggle").removeClass("btn-info").removeClass("off").addClass("btn-success");
                    $("#plan").prop('checked', true);
                    break;
                   default:
                    $("#plan-div .toggle").removeClass("btn-success").addClass("btn-info").addClass("off");
                    $("#plan").prop('checked', false);
                    break;
                }

                switch(data["extraBed"]){
                   case true:
                    $("#extraBed-div .toggle").removeClass("btn-default").removeClass("off").addClass("btn-sucess");
                    $("#extraBed").prop('checked', true);
                    break;
                   default:
                    $("#extraBed-div .toggle").removeClass("btn-success").addClass("btn-default").addClass("off");
                    $("#extraBed").prop('checked', false);
                    break;
                }
                var baseString = '<button type="button" id = "cancel-btn" class="btn btn-secondary" data-dismiss="modal">Close</button>';
                switch(data["roomStatus"]){
                     case "AVAILABLE":
                        baseString = baseString + '&nbsp' + checkInButton(room);
                        $("#modal-footer").html(baseString);
                        break;
                     case "OCCUPIED":
                        baseString = baseString + '&nbsp' + updateButton(room) + '&nbsp' + checkoutButton(room);
                        $("#modal-footer").html(baseString);
                        break;
                     case "CHECKOUT":
                        baseString = baseString + '&nbsp' + roomCleanedButton(room);
                        $("#modal-footer").html(baseString);
                        break;
                     default:
                        break;
             }

           }


       function checkoutButton(room){
        return '<button type="button" class="btn btn-primary"  onclick="submitData(\''+room + '\',\'CHECKOUT\')">Check Out</button>';
       }

       function checkInButton(room){
        return '<button type="button" class="btn btn-primary" onclick="submitData(\''+room + '\',' + '\'OCCUPIED\''+ ')">Check In</button>';
       }

       function updateButton(room){
        return '<button type="button" class="btn btn-primary"  onclick="submitData(\''+ room + '\',' + '\'OCCUPIED\''+ ')">Update</button>';
       }

       function roomCleanedButton(room){
        return '<button type="button" class="btn btn-primary"  onclick="submitData(\''+ room + '\',' + '\'AVAILABLE\''+ ')">Cleaned</button>';
       }
</script>
<div class="container">
    <div class="row">

        <br/>
        <br/>
        <br/>
        <div class="col-xs-4">
            <button type="button" id="101" class="btn btn-block border-dark" data-toggle="modal" data-target="#myModal" onclick="updateModal('101');">101</button>
        </div>
        <div class="col-xs-4">
            <button type="button" id="201" class="btn  btn-block border-dark" data-toggle="modal" data-target="#myModal" onclick="updateModal('201');">201</button>
        </div>
        <div class="col-xs-4">
            <button type="button" id="301" class="btn btn-block border-dark" data-toggle="modal" data-target="#myModal" onclick="updateModal('301');">301</button>
        </div>
    </div>
    </br>


    <div class="row">

        <div class="col-xs-4">
            <button type="button" id="102" class="btn btn-block border-dark" data-toggle="modal" data-target="#myModal" onclick="updateModal('102');">102</button>
        </div>
        <div class="col-xs-4">
            <button type="button" id="202" class="btn btn-block border-dark" data-toggle="modal" data-target="#myModal" onclick="updateModal('202');">202</button>
        </div>
        <div class="col-xs-4">
            <button type="button" id="302" class="btn btn-block border-dark" data-toggle="modal" data-target="#myModal" onclick="updateModal('302');">302</button>
        </div>
    </div>
    </br>
    <div class="row">

        <div class="col-xs-4">
        </div>
        <div class="col-xs-4">
            <button type="button" id="205" class="btn btn-block border-dark" data-toggle="modal" data-target="#myModal" onclick="updateModal('205');">205</button>
        </div>
        <div class="col-xs-4">
            <button type="button" id="305" class="btn btn-block border-dark" data-toggle="modal" data-target="#myModal" onclick="updateModal('305');">305</button>
        </div>
    </div>
    <br/>
    <div class="modal" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button style="font-size:26px;" type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h2 class="modal-title" id="roomNumber" style="text-align:center">101</h2>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">

                        </div>
                        <div class="row">
                            <div class="col-xs-6">
                                <label for="Playo" class="col-form-label"  style="font-size: 17px;">Name </label>
                                <input autocomplete="off" type="text"  style="font-size: 17px;text-align:center" class="form-control" id="name" >
                            </div>
                            <div class="col-xs-6">
                                <label for="Cash" class="col-form-label"  style="font-size: 17px;">Phone </label>
                                <input autocomplete="off" type="text"  style="font-size: 17px;text-align:center" class="form-control" id="phone" >
                            </div>
                        </div>
                        <br/>
                        <br/>
                        <div class="row">


                            <div class="col-xs-4">
                                <label for="Playo" class="col-form-label"  style="font-size: 17px;">Guests : &nbsp</label>

                                <select id = "guest_count" style="font-size: 17px;padding: 5px 15px;" class="form-select" aria-label="Default select example">
                                    <option selected>-</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                </select>
                            </div>
                            <div class="col-xs-4" id="plan-div">
                                <label for="Cash" class="col-form-label"  style="font-size: 17px;">Plan : &nbsp</label>

                                <input id="plan" style="padding: 5px 10px;font-size: 14px;" type="checkbox" data-toggle="toggle" data-on="CP" data-off="EP" data-onstyle="success" data-offstyle="info" >

                            </div>
                            <div class="col-xs-4" id="extraBed-div">
                                <label for="UPI" class="col-form-label"  style="font-size: 17px;">Extra Bed : &nbsp</label>
                                <input id="extraBed" style="padding: 5px 10px;font-size: 14px;" type="checkbox" data-toggle="toggle" data-on="YES" data-off="NO" data-onstyle="success" >
                            </div>
                        </div>
                        <br/>
                        <br/>
                        <br/>
                        <div class="row">
                            <div class="col-xs-4" style="text-align:left;font-size: 17px;">
                                <label for="datepicker1">Check In&nbsp</label>
                                <input id="datepicker1"  autocomplete="off"/>
                            </div>
                            <div class="col-xs-1" style="text-align:left;font-size: 17px;">
                            </div>
                            <div class="col-xs-4" style="text-align:center;font-size: 17px;">
                                <label>Tariff&nbsp</label>
                                <input id="tariff"  style="text-align:center;" autocomplete="off"/>
                            </div>
                        </div>
                        <br/>
                        <br/>
                        <div class="form-group">
                            <label for="message-text" class="col-form-label" style="font-size: 17px;"> Remark:</label>
                            <textarea class="form-control" id="remark" style="font-size: 17px;"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer" id="modal-footer">
                </div>
            </div>
        </div>
    </div>

    <div class="row">

        <div class="col-xs-4">
            <button type="button" id="104" class="btn btn-block border-dark" data-toggle="modal" data-target="#myModal" onclick="updateModal('104');">104</button>
        </div>
        <div class="col-xs-4">
            <button type="button" id="204" class="btn btn-block border-dark" data-toggle="modal" data-target="#myModal" onclick="updateModal('204');">204</button>
        </div>
        <div class="col-xs-4">
            <button type="button" id="304" class="btn btn-block border-dark" data-toggle="modal" data-target="#myModal" onclick="updateModal('304');">304</button>
        </div>
    </div>
    <br/>
    <div class="row">

        <div class="col-xs-4">
            <button type="button" id="103" class="btn btn-block border-dark" data-toggle="modal" data-target="#myModal" onclick="updateModal('103');">103</button>
        </div>
        <div class="col-xs-4">
            <button type="button" id="203" class="btn btn-block border-dark" data-toggle="modal" data-target="#myModal" onclick="updateModal('203');">203</button>
        </div>
        <div class="col-xs-4">
        </div>
    </div>
    <br/><br/>
    <div class="row">
        <div class="col-xs-4" style="text-align:left;">
            <button type="button" style = "padding: 5px 5px;" class="btn btn-success"></button> &nbsp Available
            <br/>
            <button type="button" style = "padding: 5px 5px;" class="btn btn-danger"></button> &nbsp Occupied
            <br/>
            <button type="button" style = "padding: 5px 5px;" class="btn btn-primary"></button> &nbsp Checkout
        </div>
    </div>
</div>
</body>
</html>